import*as e from"@wordpress/interactivity";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const n=(o={getContext:()=>e.getContext,store:()=>e.store},r={},t.d(r,o),r);var o,r;function s(e){window.localStorage.removeItem(`wcb_${e}`)}const{state:i,actions:a}=(0,n.store)("carbonbadge-block",{callbacks:{doRequest:()=>{const e=(0,n.getContext)();if(e.measureDiv=i.i18n.measuringCO2,e.darkMode=i.isDarkMode,"fetch"in window){const t=function(e){const t=window.localStorage.getItem(`wcb_${e}`);if(!t)return null;const n=JSON.parse(t);return(new Date).getTime()-n.t>864e5?(s(e),null):n}(w);t?(e.resultData=t,a.renderResult()):a.newRequest()}}},actions:{*renderResult(){const e=(0,n.getContext)();if(!e||!e.resultData)return void(e.measureDiv=i.i18n.noResult);const t=e.resultData;if(!t||!t.c||!t.p)return void(e.measureDiv=i.i18n.noResult);const o=i.i18n.gOfCO2PerView.replace("%s",t.c),r=i.i18n.cleanerThan.replace("%s",t.p);e.measureDiv=o,e.belowText=r,e.showLinkToWebCarbon&&(e.websiteCarbonLink=`https://websitecarbon.com/website/${c}`)},*newRequest(){const e=(0,n.getContext)();yield fetch(`https://api.websitecarbon.com/b?url=${w}`).then((e=>{if(!e.ok)throw Error(e);return e.json()})).then((t=>{var n,o;e.resultData=t,n=w,(o=t).t=(new Date).getTime(),window.localStorage.setItem(`wcb_${n}`,JSON.stringify(o)),a.renderResult()})).catch((t=>{throw s(w),e.measureDiv=i.i18n.noResult,new Error(t)}))}}}),c=(u=i.useCustomUrl,l=i.customUrlToCheck,u&&""!==l?decodeURIComponent(l):window.location.href);var u,l;const w=function(e){const t=function(e){return e.indexOf("wp-admin")>-1}(e)?e.split("wp-admin")[0]:e;return encodeURIComponent(t.endsWith("/")?t:`${t}/`)}(c);